<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>AtomoTech ‚Äî Gest√£o</title>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBUF-WA58TIK259hYy7HECYLRbhOyqR1pE",
      authDomain: "atomotech-sistema.firebaseapp.com",
      projectId: "atomotech-sistema",
      storageBucket: "atomotech-sistema.firebasestorage.app",
      messagingSenderId: "106133482163",
      appId: "1:106133482163:web:0fdcd843ae3e778fe15ec6",
      measurementId: "G-34WWR2929E"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // Salvar Or√ßamento
    async function salvarOrcamento(event) {
      event.preventDefault();
      const cliente = document.getElementById("orcCliente").value;
      const descricao = document.getElementById("orcDescricao").value;

      const itens = [];
      document.querySelectorAll("#tabelaOrcamento tbody tr").forEach(row => {
        const desc = row.children[0].children[0].value;
        const qtd = parseFloat(row.children[1].children[0].value) || 0;
        const val = parseFloat(row.children[2].children[0].value) || 0;
        const total = parseFloat(row.children[3].children[0].value) || 0;
        if (desc) {
          itens.push({ descricao: desc, quantidade: qtd, valorUnitario: val, total });
        }
      });

      try {
        await addDoc(collection(db, "orcamentos"), {
          cliente,
          descricao,
          itens,
          criadoEm: new Date()
        });
        alert("‚úÖ Or√ßamento salvo com sucesso!");
        limparOrcamento();
        showPage("homePage");
      } catch (e) {
        console.error("Erro ao salvar or√ßamento: ", e);
        alert("‚ùå Erro ao salvar or√ßamento.");
      }
    }

    // Salvar OS
    async function salvarOS(event) {
      event.preventDefault();
      const cliente = document.getElementById("osCliente").value;
      const servico = document.getElementById("osServico").value;
      const responsavel = document.getElementById("osResponsavel").value;
      const inicio = document.getElementById("osInicio").value;
      const conclusao = document.getElementById("osConclusao").value;
      const obs = document.getElementById("osObs").value;

      const equipamentos = [];
      document.querySelectorAll("#tabelaEquipamentos tbody tr").forEach(row => {
        const desc = row.children[0].children[0].value;
        const qtd = parseFloat(row.children[1].children[0].value) || 0;
        if (desc) {
          equipamentos.push({ descricao: desc, quantidade: qtd });
        }
      });

      try {
        await addDoc(collection(db, "ordensServico"), {
          cliente,
          servico,
          responsavel,
          inicio,
          conclusao,
          observacoes: obs,
          equipamentos,
          criadoEm: new Date()
        });
        alert("‚úÖ Ordem de Servi√ßo salva com sucesso!");
        limparOS();
        showPage("homePage");
      } catch (e) {
        console.error("Erro ao salvar OS: ", e);
        alert("‚ùå Erro ao salvar OS.");
      }
    }

    window.salvarOrcamento = salvarOrcamento;
    window.salvarOS = salvarOS;
  </script>

  <style>
    body { font-family: Arial, sans-serif; margin:0; padding:0; background:#f4f6f8; }
    header { background:#0b66ff; color:white; padding:16px; display:flex; justify-content:space-between; align-items:center; }
    header h1 { margin:0; font-size:22px; }
    .container { padding:20px; }
    .cards { display:flex; gap:20px; }
    .card { background:white; border-radius:10px; padding:20px; text-align:center; flex:1; box-shadow:0 2px 6px rgba(0,0,0,0.1); }
    .card h3 { margin:10px 0; }
    .card button { padding:10px 20px; border:none; border-radius:6px; cursor:pointer; font-size:14px; margin-top:10px; }
    .btn-green { background:#28a745; color:white; }
    .btn-blue { background:#007bff; color:white; }
    .btn-gray { background:#4a4a4a; color:white; }
    .hidden { display:none; }
    form { background:white; padding:20px; border-radius:10px; box-shadow:0 2px 6px rgba(0,0,0,0.1); max-width:700px; margin:0 auto; }
    form label { display:block; margin-top:10px; font-weight:bold; }
    form input, form textarea { width:100%; padding:8px; margin-top:5px; border:1px solid #ccc; border-radius:6px; }
    form table { width:100%; border-collapse:collapse; margin-top:15px; }
    form th, form td { border:1px solid #ddd; padding:8px; text-align:center; }
    form th { background:#f4f4f4; }
    .actions { margin-top:20px; text-align:right; }
  </style>
</head>
<body>
  <header>
    <h1>AtomoTech</h1>
  </header>

  <div class="container">

    <!-- P√°gina Inicial -->
    <div id="homePage">
      <h2>Painel de Gest√£o</h2>
      <div class="cards">
        <div class="card">
          <h3>üìÑ Novo Or√ßamento</h3>
          <button class="btn-green" onclick="showPage('orcamentoPage')">Criar Or√ßamento</button>
        </div>
        <div class="card">
          <h3>üîß Nova Ordem de Servi√ßo</h3>
          <button class="btn-blue" onclick="showPage('osPage')">Criar OS</button>
        </div>
      </div>
    </div>

    <!-- P√°gina Or√ßamento -->
    <div id="orcamentoPage" class="hidden">
      <h2>Novo Or√ßamento</h2>
      <form onsubmit="salvarOrcamento(event)">
        <label>Cliente</label>
        <input type="text" id="orcCliente" placeholder="Nome do cliente">

        <label>Descri√ß√£o do Projeto</label>
        <textarea id="orcDescricao" rows="3"></textarea>

        <h3>Itens do Or√ßamento</h3>
        <table id="tabelaOrcamento">
          <thead>
            <tr><th>Descri√ß√£o</th><th>Qtd</th><th>Valor Unit√°rio</th><th>Total</th></tr>
          </thead>
          <tbody></tbody>
        </table>
        <button type="button" class="btn-blue" onclick="addItem()">+ Adicionar Item</button>

        <div class="actions">
          <button type="button" class="btn-gray" onclick="limparOrcamento()">üßπ Limpar</button>
          <button type="button" class="btn-gray" onclick="showPage('homePage')">‚¨Ö Voltar</button>
          <button type="submit" class="btn-green">Salvar</button>
        </div>
      </form>
    </div>

    <!-- P√°gina OS -->
    <div id="osPage" class="hidden">
      <h2>Nova Ordem de Servi√ßo</h2>
      <form onsubmit="salvarOS(event)">
        <label>Cliente</label>
        <input type="text" id="osCliente">

        <label>Servi√ßo</label>
        <input type="text" id="osServico">

        <label>Respons√°vel T√©cnico</label>
        <input type="text" id="osResponsavel">

        <label>Data de In√≠cio</label>
        <input type="date" id="osInicio">

        <label>Data Prevista de Conclus√£o</label>
        <input type="date" id="osConclusao">

        <label>Observa√ß√µes</label>
        <textarea id="osObs" rows="3"></textarea>

        <h3>Equipamentos Usados</h3>
        <table id="tabelaEquipamentos">
          <thead>
            <tr><th>Descri√ß√£o</th><th>Qtd</th></tr>
          </thead>
          <tbody></tbody>
        </table>
        <button type="button" class="btn-blue" onclick="addEquipamento()">+ Adicionar Equipamento</button>

        <div class="actions">
          <button type="button" class="btn-gray" onclick="limparOS()">üßπ Limpar</button>
          <button type="button" class="btn-gray" onclick="showPage('homePage')">‚¨Ö Voltar</button>
          <button type="submit" class="btn-blue">Salvar OS</button>
        </div>
      </form>
    </div>
  </div>

  <script>
    function showPage(pageId) {
      document.querySelectorAll(".container > div").forEach(div => div.classList.add("hidden"));
      document.getElementById(pageId).classList.remove("hidden");
    }

    // Or√ßamento
    function addItem() {
      const tabela = document.querySelector("#tabelaOrcamento tbody");
      const row = document.createElement("tr");
      row.innerHTML = `
        <td><input type="text"></td>
        <td><input type="number" min="1" value="1"></td>
        <td><input type="number" min="0" step="0.01"></td>
        <td><input type="text" readonly></td>
      `;
      tabela.appendChild(row);

      row.querySelectorAll("input").forEach(input => {
        input.addEventListener("input", () => {
          const qtd = parseFloat(row.children[1].children[0].value) || 0;
          const val = parseFloat(row.children[2].children[0].value) || 0;
          row.children[3].children[0].value = (qtd * val).toFixed(2);
        });
      });
    }
    function limparOrcamento() {
      document.getElementById("orcCliente").value = "";
      document.getElementById("orcDescricao").value = "";
      document.querySelector("#tabelaOrcamento tbody").innerHTML = "";
    }

    // OS
    function addEquipamento() {
      const tabela = document.querySelector("#tabelaEquipamentos tbody");
      const row = document.createElement("tr");
      row.innerHTML = `
        <td><input type="text"></td>
        <td><input type="number" min="1" value="1"></td>
      `;
      tabela.appendChild(row);
    }
    function limparOS() {
      document.getElementById("osCliente").value = "";
      document.getElementById("osServico").value = "";
      document.getElementById("osResponsavel").value = "";
      document.getElementById("osInicio").value = "";
      document.getElementById("osConclusao").value = "";
      document.getElementById("osObs").value = "";
      document.querySelector("#tabelaEquipamentos tbody").innerHTML = "";
    }
  </script>
</body>
</html>
